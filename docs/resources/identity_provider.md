---
page_title: "infra_identity_provider Resource - terraform-provider-infra"
subcategory: ""
description: |-
  The infra identity provider resource can be used to create and manage identity providers.
---

# infra_identity_provider

The infra identity provider resource can be used to create and manage identity providers.

## Example Usage

```terraform
# Connect a generic OIDC identity provider
resource "infra_identity_provider" "example" {
  issuer        = "https://my.oidc.provider.com/"
  client_id     = "example_client_id"
  client_secret = "example_client_secret"
}

# Connect Azure AD
data "azuread_client_config" "current" {}

resource "infra_identity_provider" "azure" {
  client_id     = "example_client_id"
  client_secret = "example_client_secret"

  azure {
    tenant_id = data.azuread_client_config.current.tenant_id
  }
}

# Connect Google without groups
resource "infra_identity_provider" "google" {
  client_id     = "example_client_id"
  client_secret = "example_client_secret"

  google {}
}

# Connect Google with groups
resource "google_service_account" "my_account" {
  account_id = "myaccount"
}

resource "google_service_account_key" "my_key" {
  service_account_id = google_service_account.my_account.name
}

resource "infra_identity_provider" "google_groups" {
  client_id     = "example_client_id"
  client_secret = "example_client_secret"

  google {
    admin_email         = "admin@example.com"
    service_account_key = base64decode(google_service_account_key.my_key.private_key)
  }
}

# Connect Google with groups (manual)
resource "infra_identity_provider" "google_groups" {
  client_id     = "example_client_id"
  client_secret = "example_client_secret"

  google {
    admin_email = "admin@example.com"
    service_account_key = jsonencode({
      private_key : "...",
      client_email : "...",
    })
  }
}

# Connect Okta
data "okta_auth_server" "default" {
  name = "default"
}

resource "okta_app_oauth" "infra" {
  label          = "Infra"
  type           = "web"
  grant_types    = ["authorization_code", "refresh_token"]
  response_types = ["code"]

  redirect_uris = [
    "https://my_organization.infrahq.com/login/callback",
  ]

  groups_claim {
    type        = "FILTER"
    filter_type = "REGEX"
    name        = "groups"
    value       = ".*"
  }

  lifecycle {
    ignore_changes = [
      groups,
    ]
  }
}

data "okta_everyone_group" "everyone" {}

resource "okta_app_group_assignments" "example" {
  app_id = okta_app_oauth.infra.id
  group {
    id = data.okta_everyone_group.everyone.id
  }
}

resource "infra_identity_provider" "okta" {
  client_id     = okta_app_oauth.infra.client_id
  client_secret = okta_app_oauth.infra.client_secret

  okta {
    issuer = data.okta_auth_server.default.issuer
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `client_id` (String) The identity provider's OIDC client ID.
- `client_secret` (String, Sensitive) The identity provider's OIDC client secret.

### Optional

- `azure` (Block List, Max: 1) Azure AD identity provider configurations. One of `issuer`, `google`, `azure`, `okta` must be set. (see [below for nested schema](#nestedblock--azure))
- `google` (Block List, Max: 1) Google identity provider configurations. One of `issuer`, `google`, `azure`, `okta` must be set. (see [below for nested schema](#nestedblock--google))
- `issuer` (String) The identity provider's full authorization server URL. Must start with `https://`. One of `issuer`, `google`, `azure`, `okta` must be set.
- `name` (String) The identity provider's name. If omitted, a name will be automatically generated. Identity provider names may include letters (uppercase and lowercase), numbers, underscores `_`, hyphens `-`, and periods `.`.
- `okta` (Block List, Max: 1) Okta identity provider configurations. One of `issuer`, `google`, `azure`, `okta` must be set. (see [below for nested schema](#nestedblock--okta))

### Read-Only

- `id` (String) The identity provider's unique identifier.

<a id="nestedblock--azure"></a>
### Nested Schema for `azure`

Required:

- `tenant_id` (String) The Azure AD tenant ID.


<a id="nestedblock--google"></a>
### Nested Schema for `google`

Optional:

- `admin_email` (String) A Google workspace admin user email. Infra will impersonate this user when making API calls to retrieve Google groups. If set, `service_account_key` must also be set.
- `service_account_key` (String, Sensitive) A Google service account private key file. Must be a JSON-formatted string. If set, `admin_email` must also be set.


<a id="nestedblock--okta"></a>
### Nested Schema for `okta`

Required:

- `issuer` (String) The full Okta authorization server URL. Must start with `https://`.

## Import

Import is supported using the following syntax:

```shell
terraform import infra_identity_provider.example <identity_provider_id>
```
